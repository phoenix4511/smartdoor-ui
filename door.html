<!DOCTYPE html>
<html lang="fa">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>SmartDoor โ ฺฉูุชุฑู</title>
<link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
<link rel="stylesheet" href="style.css"></head>
<body>
<div class="container"><div class="card">
  <div class="header"><div class="title">ฺฉูุชุฑู ุฏุฑ</div><div><button id="themeBtn" class="theme-toggle">ุฑูุดู</button></div></div>
  <div style="text-align:center">
    <div id="lock" class="icon-large">๐</div>
    <button class="btn" onclick="onOpen()">ุจุงุฒ ฺฉุฑุฏู ุฏุฑ</button>
    <div class="msg" id="msg"></div>
    <div style="margin-top:10px;text-align:center;"><button class="link-btn" onclick="location.href='user.html'">ูพุฑููุงู</button> &nbsp; <button class="link-btn" onclick="doLogout()">ุฎุฑูุฌ</button></div>
  </div>
</div></div>
<script src="script.js"></script>
<script>
if(!requireLogin('/index.html')){};
async function onOpen(){
  const msg=document.getElementById('msg');
  const lock=document.getElementById('lock');
  msg.textContent='ุฏุฑ ุญุงู ุงุฑุณุงู ุฏุณุชูุฑ...';
  const res = await requestOpen();
  if(res.ok){ 
    try{ const j = await res.json(); if(j.result==='ok'){ lock.classList.add('lock-open'); lock.textContent='๐'; msg.textContent='โ ุฏุฑุจ ุจุง ููููุช ุจุงุฒ ุดุฏ'; return; } else { msg.textContent = 'โ '+(j.message||'ุฎุทุง'); return; } } catch(e){ msg.textContent='โ ูพุงุณุฎ ูุงูุนุชุจุฑ ุงุฒ ุณุฑูุฑ'; return; }
  } else {
    const t = await res.text().catch(()=> 'ุฎุทุง ุณุฑูุฑ');
    msg.textContent = 'โ ' + t;
  }
}
</script>
</body>
</html>
